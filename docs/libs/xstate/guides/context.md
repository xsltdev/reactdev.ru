# –ö–æ–Ω—Ç–µ–∫—Å—Ç

–•–æ—Ç—è _–∫–æ–Ω–µ—á–Ω—ã–µ_ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –∫–æ–Ω–µ—á–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∞—Ö –∏ ‚Äã‚Äã–¥–∏–∞–≥—Ä–∞–º–º–∞—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç _–∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ_ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞, –æ–±—ä–µ–∫—Ç—ã –∏ —Ç. –¥.), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ [—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ](https://en.wikipedia.org/wiki/UML_state_machine#Extended_states). –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω—ã–º–∏ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

–í XState —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ –∫–∞–∫ **–∫–æ–Ω—Ç–µ–∫—Å—Ç** (_context_). –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `context` –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ –≤–æ–¥–æ–π:

```js
import { createMachine, assign } from 'xstate';

// Action to increment the context amount
const addWater = assign({
  amount: (context, event) => context.amount + 1,
});

// Guard to check if the glass is full
function glassIsFull(context, event) {
  return context.amount >= 10;
}

const glassMachine = createMachine(
  {
    id: 'glass',
    // the initial context (extended state) of the statechart
    context: {
      amount: 0,
    },
    initial: 'empty',
    states: {
      empty: {
        on: {
          FILL: {
            target: 'filling',
            actions: 'addWater',
          },
        },
      },
      filling: {
        // Transient transition
        always: {
          target: 'full',
          cond: 'glassIsFull',
        },
        on: {
          FILL: {
            target: 'filling',
            actions: 'addWater',
          },
        },
      },
      full: {},
    },
  },
  {
    actions: { addWater },
    guards: { glassIsFull },
  }
);
```

–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `State` –∫–∞–∫ `state.context`:

```js
const nextState = glassMachine.transition(
  glassMachine.initialState,
  {
    type: 'FILL',
  }
);

nextState.context;
// => { amount: 1 }
```

## –ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–≤–æ–π—Å—Ç–≤–µ `context` –∞–≤—Ç–æ–º–∞—Ç–∞:

```js
const counterMachine = createMachine({
  id: 'counter',
  // initial context
  context: {
    count: 0,
    message: 'Currently empty',
    user: {
      name: 'David',
    },
    allowedToIncrement: true,
    // ... etc.
  },
  states: {
    // ...
  },
});
```

–î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Ç–æ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–¥–∞–µ—Ç—Å—è –∏–∑–≤–Ω–µ) –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```js
const createCounterMachine = (count, time) => {
  return createMachine({
    id: 'counter',
    // values provided from function arguments
    context: {
      count,
      time,
    },
    // ...
  });
};

const counterMachine = createCounterMachine(42, Date.now());
```

–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `machine.withContext(...)`:

```js
const counterMachine = createMachine({
  /* ... */
});

// retrieved dynamically
const someContext = { count: 42, time: Date.now() };

const dynamicCounterMachine = counterMachine.withContext(
  someContext
);
```

–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–∞—à–∏–Ω—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –µ–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```js
dynamicCounterMachine.initialState.context;
// => { count: 42, time: 1543687816981 }
```

–≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ `machine.context`, —Ç–∞–∫ –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π `assign(...)` –∏ –ø—Ä–æ—Ö–æ–¥–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –µ—Å–ª–∏ —Ç–∞–∫–æ–≤—ã–µ –∏–º–µ—é—Ç—Å—è.

## –î–µ–π—Å—Ç–≤–∏–µ assign()

–î–µ–π—Å—Ç–≤–∏–µ `assign()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∞. –û–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç `assigner`, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏—Å–≤–æ–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

| –ü–∞—Ä–∞–º–µ—Ç—Ä   | –¢–∏–ø                  | –û–ø–∏—Å–∞–Ω–∏–µ                                                   |
| ---------- | -------------------- | ---------------------------------------------------------- |
| `assigner` | object<br />function | –û–±—ä–µ–∫—Ç –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É |

`assigner` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ):

```js
import { createMachine, assign } from 'xstate';
// example: property assigner

// ...
  actions: assign({
    // increment the current count by the event value
    count: (context, event) => context.count + event.value,

    // assign static value to the message (no function needed)
    message: 'Count changed'
  }),
// ...
```

–ò–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

```js
// example: context assigner

// ...

  // return a partial (or full) updated context
  actions: assign((context, event) => {
    return {
      count: context.count + event.value,
      message: 'Count changed'
    }
  }),
// ...
```

–ü—Ä–∏–≤–µ–¥–µ–Ω–Ω–∞—è –≤—ã—à–µ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: `context`, `event` –∏ `meta`

| –ü–∞—Ä–∞–º–µ—Ç—Ä  | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                                          |
| --------- | ----------- | ------------------------------------------------- |
| `context` | TContext    | –¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) –∞–≤—Ç–æ–º–∞—Ç–∞ |
| `event`   | EventObject | –°–æ–±—ã—Ç–∏–µ, –≤—ã–∑–≤–∞–≤—à–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ `assign`              |
| `meta`    | AssignMeta  | –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–º–∏, _–Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 4.7+_    |

–û–±—ä–µ–∫—Ç –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `state` ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ (`undefined` –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- `action` ‚Äî —Å–≤—è–∑–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ `assign`

!!!warning "–í–Ω–∏–º–∞–Ω–∏–µ"

    –§—É–Ω–∫—Ü–∏—è `assign(...)` —è–≤–ª—è–µ—Ç—Å—è **—Å–æ–∑–¥–∞—Ç–µ–ª–µ–º –¥–µ–π—Å—Ç–≤–∏—è**; —ç—Ç–æ —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç –¥–µ–π—Å—Ç–≤–∏—è –∏ *–Ω–µ –¥–µ–ª–∞–µ—Ç* –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

## –ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ _—Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è_ –≤ –ø–µ—Ä–µ—Ö–æ–¥–µ. –ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–º–µ–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è `assign(...)`, —ç—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤—Å–µ–≥–¥–∞ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è _–ø–µ—Ä–≤—ã–º–∏_, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –¢–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - —ç—Ç–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).

–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —ç—Ç–æ–º —Å—á–µ—Ç—á–∏–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º:

```js
const counterMachine = createMachine({
  id: 'counter',
  context: { count: 0 },
  initial: 'active',
  states: {
    active: {
      on: {
        INC_TWICE: {
          actions: [
            (context) =>
              console.log(`Before: ${context.count}`),
            assign({
              count: (context) => context.count + 1,
            }), // count === 1
            assign({
              count: (context) => context.count + 1,
            }), // count === 2
            (context) =>
              console.log(`After: ${context.count}`),
          ],
        },
      },
    },
  },
});

interpret(counterMachine)
  .start()
  .send({ type: 'INC_TWICE' });
// => "Before: 2"
// => "After: 2"
```

–≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –æ–±–∞ –¥–µ–π—Å—Ç–≤–∏—è `assign(...)` –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏ (–Ω–∞ –º–∏–∫—Ä–æ—à–∞–≥–µ), –ø–æ—ç—Ç–æ–º—É —Å–ª–µ–¥—É—é—â–∏–º `context` —Å–æ—Å—Ç–æ—è–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è `{count: 2}`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±–æ–∏–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º. –î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –¥—É–º–∞—Ç—å –æ–± —ç—Ç–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ - —á–∏—Ç–∞—Ç—å –µ–≥–æ —Ç–∞–∫:

> –ö–æ–≥–¥–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `active` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–±—ã—Ç–∏–µ `INC_TWICE`, —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `active` —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º `context.count`, –∞ –∑–∞—Ç–µ–º _—ç—Ç–∏_ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

–•–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —ç—Ç–æ–≥–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∂–µ–ª–∞–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `context` —Å —è–≤–Ω—ã–º–∏ _–ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏_ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã:

```js
const counterMachine = createMachine({
  id: 'counter',
  context: { count: 0, prevCount: undefined },
  initial: 'active',
  states: {
    active: {
      on: {
        INC_TWICE: {
          actions: [
            (context) =>
              console.log(`Before: ${context.prevCount}`),
            assign({
              count: (context) => context.count + 1,
              prevCount: (context) => context.count,
            }), // count === 1, prevCount === 0
            assign({
              count: (context) => context.count + 1,
            }), // count === 2
            (context) =>
              console.log(`After: ${context.count}`),
          ],
        },
      },
    },
  },
});

interpret(counterMachine)
  .start()
  .send({ type: 'INC_TWICE' });
// => "Before: 0"
// => "After: 2"
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç —ç—Ç–æ–≥–æ:

1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∫–æ–Ω—Ç–µ–∫—Å—Ç) –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç—Å—è –±–æ–ª–µ–µ —è–≤–Ω–æ
2. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ—è–≤–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ç—Ä—É–¥–Ω–æ—É–ª–æ–≤–∏–º—ã—Ö –æ—à–∏–±–æ–∫.
3. –ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –±–æ–ª–µ–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º (–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ¬´–î–æ¬ª –º–æ–∂–µ—Ç –∏–¥—Ç–∏ –¥–∞–∂–µ –ø–æ—Å–ª–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ¬´–ü–æ—Å–ª–µ¬ª!)
4. –û–±–ª–µ–≥—á–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–∑—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- üö´ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç `context` –∞–≤—Ç–æ–º–∞—Ç–∞ –∏–∑–≤–Ω–µ. –£ –≤—Å–µ–≥–æ –µ—Å—Ç—å –ø—Ä–∏—á–∏–Ω–∞, –∏ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —è–≤–Ω–æ –∏–∑-–∑–∞ —Å–æ–±—ã—Ç–∏—è.
- –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –æ–±—ä–µ–∫—Ç–∞ `assign({...})`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—É–¥—É—â–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å, _–∫–∞–∫_ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ.
- –ó–∞–¥–∞–Ω–∏—è `assign` –º–æ–∂–Ω–æ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å, –∏ –æ–Ω–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

```js
// ...
  actions: [
    assign({ count: 3 }), // context.count === 3
    assign({ count: context => context.count * 2 }) // context.count === 6
  ],
// ...
```

- –ö–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å `actions`, –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è `assign()` –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–π, –∞ –∑–∞—Ç–µ–º —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∞:

```js hl_lines="6"
const countMachine = createMachine({
  initial: 'start',
  context: { count: 0 }
  states: {
    start: {
      entry: 'increment'
    }
  }
}, {
  actions: {
    increment: assign({ count: context => context.count + 1 }),
    decrement: assign({ count: context => context.count - 1 })
  }
});
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```js hl_lines="9"
const increment = assign({ count: context => context.count + 1 });
const decrement = assign({ count: context => context.count - 1 });

const countMachine = createMachine({
  initial: 'start',
  context: { count: 0 }
  states: {
    start: {
      // Named function
      entry: increment
    }
  }
});
```

- –í –∏–¥–µ–∞–ª–µ `context` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç JavaScript, —Ç. –µ. –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–º –∫–∞–∫ JSON.
- –ü–æ—Å–∫–æ–ª—å–∫—É –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—è `assign()`, –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥—Ä—É–≥–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Ç–æ–º –∂–µ —à–∞–≥–µ –ø–æ–ª—É—á–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∞ –Ω–µ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è `assign()`. –í—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, –Ω–æ –∏–º–µ–π—Ç–µ —ç—Ç–æ –≤ –≤–∏–¥—É.

## TypeScript

–î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Ç–∏–ø–∞, –¥–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ç–∏–ø–∞ –≤ `createMachine<TContext, ...>`:

```ts
interface CounterContext {
  count: number;
  user?: {
    name: string;
  };
}

const machine = createMachine<CounterContext>({
  // ...
  context: {
    count: 0,
    user: undefined,
  },
  // ...
});
```

–ï—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `typeof ...` –∫–∞–∫ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ:

```ts
const context = {
  count: 0,
  user: { name: '' },
};

const machine = createMachine<typeof context>({
  // ...
  context,
  // ...
});
```

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ `context` –∏ —Å–æ–±—ã—Ç–∏—è `event` –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö `assign(...)` –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ–¥–µ–Ω—ã –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∏–ø–∞, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –≤ `createMachine<TContext, TEvent>`:

```ts
interface CounterContext {
  count: number;
}

const machine = createMachine<CounterContext>({
  // ...
  context: {
    count: 0
  },
  // ...
  {
    on: {
      INCREMENT: {
        // Inferred automatically in most cases
        actions: assign({
          count: (context) => {
            // context: { count: number }
            return context.count + 1;
          }
        })
      }
    }
  }
});
```

–û–¥–Ω–∞–∫–æ –≤—ã–≤–æ–¥ TypeScript –Ω–µ –∏–¥–µ–∞–ª–µ–Ω, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–±–æ–±—â–µ–Ω–∏–π –≤ `assign<Context, Event>(...)`:

```ts hl_lines="3"
// ...
on: {
  INCREMENT: {
    // Generics guarantee proper inference
    actions: assign<CounterContext, CounterEvent>({
      count: (context) => {
        // context: { count: number }
        return context.count + 1;
      },
    });
  }
}
// ...
```

## –ö—Ä–∞—Ç–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**

```js
const machine = createMachine({
  // ...
  context: {
    count: 0,
    user: undefined,
    // ...
  },
});
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**

```js
const createSomeMachine = (count, user) => {
  return createMachine({
    // ...
    // Provided from arguments; your implementation may vary
    context: {
      count,
      user,
      // ...
    },
  });
};
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç—É**

```js
const machine = createMachine({
  // ...
  // Provided from arguments; your implementation may vary
  context: {
    count: 0,
    user: undefined,
    // ...
  },
});

const myMachine = machine.withContext({
  count: 10,
  user: {
    name: 'David',
  },
});
```

**–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**

```js
const machine = createMachine({
  // ...
  context: {
    count: 0,
    user: undefined,
    // ...
  },
  // ...
  on: {
    INCREMENT: {
      actions: assign({
        count: (context, event) => context.count + 1,
      }),
    },
  },
});
```

**–°—Ç–∞—Ç–∏—á–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ**

```js
// ...
actions: assign({
  counter: 42
}),
// ...
```

**–°–≤—è–∑—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é**

```js
// ...
actions: assign({
  counter: (context, event) => {
    return context.count + event.value;
  }
}),
// ...
```

**–°–≤—è–∑—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç**

```js
// ...
actions: assign((context, event) => {
  return {
    counter: context.count + event.value,
    time: event.time,
    // ...
  }
}),
// ...
```

**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ**

```js
// ...
// assume context.count === 1
actions: [
  // assigns context.count to 1 + 1 = 2
  assign({ count: (context) => context.count + 1 }),
  // assigns context.count to 2 * 3 = 6
  assign({ count: (context) => context.count * 3 })
],
// ...
```
